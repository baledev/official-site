---
import {
  getLangFromUrl,
  useTranslations,
  getLocalizedPath,
} from "../i18n/utils";
import { languages } from "../i18n/ui";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currentPath = Astro.url.pathname.replace(/^\/(en|id)/, "") || "/";
---

<nav
  id="main-nav"
  class="fixed top-0 left-0 right-0 z-50 glass transition-all duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a
        href={getLocalizedPath("/", lang)}
        class="text-2xl font-bold gradient-text"
      >
        Pusakadev
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        <a
          href={getLocalizedPath("/", lang)}
          class="hover:text-blue-500 transition-colors"
        >
          {t("nav.home")}
        </a>
        <a
          href={getLocalizedPath("/projects", lang)}
          class="hover:text-blue-500 transition-colors"
        >
          {t("nav.projects")}
        </a>
        <a
          href={getLocalizedPath("/about", lang)}
          class="hover:text-blue-500 transition-colors"
        >
          {t("nav.about")}
        </a>
        <a
          href={getLocalizedPath("/contact", lang)}
          class="hover:text-blue-500 transition-colors"
        >
          {t("nav.contact")}
        </a>

        <!-- Language Switcher -->
        <div class="flex items-center space-x-2 ml-4">
          {
            Object.entries(languages).map(([langCode, langName]) => (
              <a
                href={langCode === "id" ? currentPath : `/en${currentPath}`}
                class={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${
                  lang === langCode
                    ? "bg-blue-500 text-white"
                    : "hover:bg-zinc-200 dark:hover:bg-zinc-800"
                }`}
              >
                {langCode.toUpperCase()}
              </a>
            ))
          }
        </div>

        <!-- Dark Mode Toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-800 transition-colors"
          aria-label="Toggle dark mode"
        >
          <svg
            class="w-5 h-5 dark:hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
          <svg
            class="w-5 h-5 hidden dark:block"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-800 transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-zinc-200 dark:border-zinc-800"
  >
    <div class="px-4 py-4 space-y-3">
      <a
        href={getLocalizedPath("/", lang)}
        class="block hover:text-blue-500 transition-colors"
      >
        {t("nav.home")}
      </a>
      <a
        href={getLocalizedPath("/projects", lang)}
        class="block hover:text-blue-500 transition-colors"
      >
        {t("nav.projects")}
      </a>
      <a
        href={getLocalizedPath("/about", lang)}
        class="block hover:text-blue-500 transition-colors"
      >
        {t("nav.about")}
      </a>
      <a
        href={getLocalizedPath("/contact", lang)}
        class="block hover:text-blue-500 transition-colors"
      >
        {t("nav.contact")}
      </a>

      <!-- Mobile Language Switcher -->
      <div class="flex items-center space-x-2 pt-2">
        {
          Object.entries(languages).map(([langCode, langName]) => (
            <a
              href={langCode === "id" ? currentPath : `/en${currentPath}`}
              class={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${
                lang === langCode
                  ? "bg-blue-500 text-white"
                  : "hover:bg-zinc-200 dark:hover:bg-zinc-800"
              }`}
            >
              {langCode.toUpperCase()}
            </a>
          ))
        }
      </div>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });

  // Dark mode toggle
  const themeToggle = document.getElementById("theme-toggle");

  themeToggle?.addEventListener("click", () => {
    const isDark = document.documentElement.classList.contains("dark");

    if (isDark) {
      document.documentElement.classList.remove("dark");
      localStorage.setItem("theme", "light");
    } else {
      document.documentElement.classList.add("dark");
      localStorage.setItem("theme", "dark");
    }
  });

  // Navbar scroll effect
  const nav = document.getElementById("main-nav");
  const updateNav = () => {
    if (window.scrollY > 10) {
      nav?.classList.add(
        "bg-white/90",
        "dark:bg-zinc-900/90",
        "shadow-md",
        "backdrop-blur-md",
      );
      nav?.classList.remove("glass");
    } else {
      nav?.classList.remove(
        "bg-white/90",
        "dark:bg-zinc-900/90",
        "shadow-md",
        "backdrop-blur-md",
      );
      nav?.classList.add("glass");
    }
  };

  window.addEventListener("scroll", updateNav);
  // Initial check
  updateNav();
</script>
