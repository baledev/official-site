---
interface Props {
    lang?: string;
}

const { lang = "id" } = Astro.props;
---

<div class="mt-16">
    <script
        src="https://giscus.app/client.js"
        data-repo="baledev/official-site"
        data-repo-id="R_kgDOQ7Fd7g"
        data-category="General"
        data-category-id="DIC_kwDOQ7Fd7s4C1D27"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="transparent_dark"
        data-lang={lang}
        crossorigin="anonymous"
        async></script>
</div>

<script is:inline>
    function updateGiscusTheme() {
        const theme = document.documentElement.classList.contains("dark")
            ? "transparent_dark"
            : "light";
        const iframe = document.querySelector("iframe.giscus-frame");
        if (!iframe) return;
        iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app",
        );
    }

    // Observe dark mode changes
    const observer = new MutationObserver(updateGiscusTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ["class"],
    });

    // Initial load handling because Giscus loads async
    window.addEventListener("load", () => {
        // Just in case Giscus isn't ready, we might want to wait or just rely on 'preferred_color_scheme' initially
        // But actually, we can try to set it once the iframe loads.
        // However, configuring `data-theme` in the script tag is the best initial state.
        // Since we don't know the state at SSG time, we'll let the script fix it if needed.
        updateGiscusTheme();
    });
</script>
