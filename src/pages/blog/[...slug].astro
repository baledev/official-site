---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";

export async function getStaticPaths() {
    // Get all blog posts
    const posts = await getCollection("blog");

    // We need to handle the slug. The slug is like "en/hello-world" or "id/halo-dunia".
    // Since this file is `src/pages/blog/[...slug].astro`, it will handle `/blog/halo-dunia`.
    // Wait, `src/pages/blog/index.astro` was hardcoded to filter for "id".
    // The user didn't explicitly ask for multilang blog, but the site is multilang.
    // For simplicity and "same concept as project", I should try to support it.
    // However, `src/pages/projects/[slug].astro` only handles "id" projects in `getStaticPaths`.
    // I will follow the same pattern: This page is for Indonesian content?
    // Let's look at `src/pages/projects/[slug].astro` again. It filters `data.lang === "id"`.
    // And `src/pages/projects/index.astro` also filters `data.lang === "id"`.
    // So the default experience is Indonesian.
    // I will filter for "id" folders here as well for consistency.

    const idPosts = posts.filter((post) => post.data.lang === "id");

    return idPosts.map((post) => ({
        params: { slug: post.slug.split("/").pop() },
        props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout
    title={`${post.data.title} - Blog`}
    description={post.data.description}
    image={post.data.coverImage}
>
    <Navigation />

    <main class="pt-24 pb-20">
        <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <header class="mb-12 text-center">
                <div class="mb-6 flex justify-center gap-2">
                    {
                        post.data.tags.map((tag) => (
                            <span class="px-3 py-1 bg-zinc-100 dark:bg-zinc-800 rounded-full text-sm font-medium text-zinc-600 dark:text-zinc-400">
                                #{tag}
                            </span>
                        ))
                    }
                </div>

                <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text">
                    {post.data.title}
                </h1>

                <div
                    class="flex items-center justify-center text-zinc-600 dark:text-zinc-400 gap-4 mb-8"
                >
                    <span class="flex items-center">
                        <svg
                            class="w-5 h-5 mr-2"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                            ></path>
                        </svg>
                        {
                            post.data.pubDate.toLocaleDateString("id-ID", {
                                year: "numeric",
                                month: "long",
                                day: "numeric",
                            })
                        }
                    </span>
                    <span>â€¢</span>
                    <span class="flex items-center">
                        <svg
                            class="w-5 h-5 mr-2"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                            ></path>
                        </svg>
                        {post.data.author}
                    </span>
                </div>

                {
                    post.data.coverImage && (
                        <div class="rounded-xl overflow-hidden shadow-2xl mb-12">
                            <img
                                src={post.data.coverImage}
                                alt={post.data.title}
                                class="w-full h-auto"
                            />
                        </div>
                    )
                }
            </header>

            <!-- Content -->
            <div class="prose dark:prose-invert max-w-none prose-lg mx-auto">
                <Content />
            </div>
        </article>
    </main>

    <Footer />
</BaseLayout>
